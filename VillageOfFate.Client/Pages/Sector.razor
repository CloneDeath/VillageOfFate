@page "/world/sectors/{Id:guid}"
@using VillageOfFate.Client.Components
@using VillageOfFate.Client.Services.Api
@using VillageOfFate.WebModels
@inject SectorsApi SectorsApi
@inject NavigationManager NavigationManager
@inject ImageApi ImageApi

<PageTitle>Villager Detail</PageTitle>

@if (sector == null) {
    <p>
        <em>Loading...</em>
    </p>
} else {
    <h1>
        <button class="btn btn-primary" @onclick="GoBack">&lt;</button>
        @sector.Position
    </h1>

    <div class="d-flex">
        <img src="@ImageApi.GetImageUrl(sector.ImageId)" alt=""/>
        <p>@sector.Description</p>
    </div>

    <div class="accordion" id="accordionPanels">
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#villagers" aria-expanded="true" aria-controls="villagers">
                    Villagers
                </button>
            </h2>
            <div id="villagers" class="accordion-collapse collapse show">
                <div class="entity-container">
                    @if (villagers == null) {
                        <em>Loading...</em>
                    } else {
                        @foreach (var villager in villagers) {
                            <VillagerComponent Villager="@villager"/>
                        }
                    }
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#items" aria-expanded="true" aria-controls="items">
                    Items
                </button>
            </h2>
            <div id="items" class="accordion-collapse collapse show">
                <div class="entity-container">
                    @if (sector.Items.Any()) {
                        @foreach (var item in sector.Items) {
                            <ItemComponent Item="@item"/>
                        }
                    } else {
                        <i>Empty</i>
                    }
                </div>
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public Guid Id { get; set; }

    private WebSector? sector;
    private IEnumerable<WebVillager>? villagers;

    protected override async Task OnParametersSetAsync() {
        sector = await SectorsApi.GetSectorAsync(Id);
        villagers = await SectorsApi.GetVillagersAsync(Id);
    }

    private void GoBack() {
        NavigationManager.NavigateTo("/world");
    }

}

